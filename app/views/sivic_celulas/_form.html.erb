<%= form_for(@sivic_celula) do |f| %>
  <% if @sivic_celula.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@sivic_celula.errors.count, "error") %> prohibited this sivic_celula from being saved:</h2>

      <ul>
      <% @sivic_celula.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

<div class="containermininmo">
<div class="tabbable">
      <ul class="nav nav-tabs">
          <li class="active">
            <a href="#tab1" data-toggle="tab">Dados Evento</a>
          </li>
          <li>
            <a href="#tab2" data-toggle="tab">Endereço</a>
          </li>        
      </ul>
  <div class="tab-content">
    <div class="tab-pane active" id="tab1">
       <table style="width:100%;" align="center">
      <tr>
        <td>
          <div class="field">
            <%= f.label :Lider %>
            <a data-toggle="modal" href="#myModal" class="btn btn-default" style='margin-bottom:10px;'>Buscar</a>
            <%= f.select :sivic_pessoa_id, {},{},{ :class => 'form-control-4' } %>
          </div>
        </td>
      </tr>      
      <tr>
        <td>    
          <div class="field">
            <%= f.label :Nome_da_Celula %>
            <%= f.text_field :NOME_Celula, :class =>  'form-control-4' %>
          </div>
        </td>
        <td> 
          <div class="field">
          <%= f.label :Sexo %>
          <%= f.collection_select :DESC_sexo, SivicCelula::SEXO, :to_s, :humanize%>
          </div>
        </td>
        <td>    
          <div class="field">
            <%= f.label :Dia_da_Semana %>
            <%= f.collection_select :NUMR_Dia, SivicCelula::DIAS, :to_s, :humanize %>
          </div>
        </td>

      </tr>
    </table>
    
    <hr>
    <table style="width:100%;">
      <tr>       
    <td>
      <div class="checkbox">
      <%= f.check_box :FLAG_crianca %>
      <%= f.label :Criança %>
      </div>
    </td>
    <td>
      <div class="checkbox">
      <%= f.check_box :FLAG_jovem %>
      <%= f.label :Jovem %>
      </div>
    </td>
    <td>
      <div class="checkbox">
      <%= f.check_box :FLAG_adulto %>
      <%= f.label :Adulto %>
      </div>
    </td>
   </table>
</div>

  <div class="tab-pane" id="tab2">
     <%=  f.fields_for :sivic_endereco do |endereco| %>
  <div class="field">
    <%= endereco.label :Bairro %><br>
    <%= endereco.text_field :DESC_Bairro %>
  </div>
  <div class="field">
    <%= endereco.label :Rua %><br>
    <%= endereco.text_field :DESC_Rua %>
  </div>
  <div class="field">
    <%= endereco.label :Complemento %><br>
    <%= endereco.text_field :DESC_Complemento %>
  </div>
  <div class="field">
    <%= endereco.label :Ponto_referência %><br>
    <%= endereco.text_field :DESC_Pontoreferencia %>
  </div>
  <div class="field">
    <%= endereco.label :CEP.capitalize %><br>
    <%= endereco.number_field :NUMR_Cep %>
  </div>

  <%=  f.fields_for :sivic_estado do |estado| %>
  <div class="field">
    <%= estado.label :Estado %><br>
    <%= estado.select :sivic_estado_id, options_from_collection_for_select(SivicEstado.all, 'id', 'nome_estado',@sivic_estado), {:include_blank => true}, {:onchange => 'changeState(this)',}%>
  </div>
  <%end%>

  <%if @sivic_cidade %>

    <div class="field">
      <%= endereco.label :Cidade %><br>
      <%= endereco.select :sivic_cidade_id, options_from_collection_for_select(@sivic_cidade, 'id', 'nome_cidade',@sivic_cidade_setada)%>
    </div>

  <%else%>

    <div class="field">
      <%= endereco.label :Cidade   %><br>
      <%= endereco.select :sivic_cidade_id, [] %><br>
    </div> 

  <%end%>

  <!--Capturando usuario logado-->
  <%=f.hidden_field :user_inclusao, :value => current_user.id%>   

  <% end %>
   </div>
       
 </div>
</div> 
  <!--
  Data Bloqueio
  =============
  <div class="field">
    <%#= f.label :DATA_Bloqueio %><br>
    <%#= f.datetime_select :DATA_Bloqueio %>
  </div>
-->
  <%=render '/layouts/iconsalvar' %>
   <% end %>

<fieldset>
  <div id="myModal" class="modal fade" style="display: none;">  
      <div class="modal-header">
        <a class="close" data-dismiss="modal">×</a>  
        <h3>Buscar Líder</h3>
      </div>
      <div class="modal-body">
        <div class="input-group input-group-lg">
          <label >Nome</label><br>
          <input id="NOME_lider_buscar" name="NOME_lider_buscar" onkeypress="buscaPessoa();" type="text" class="form-control" placeholder="Nome" style="width: 85%;">
          <a data-toggle="modal" href="javascript:usaNome();" class="btn btn-success" style="margin-bottom: 10px;">Usar</a>
        </div>
        <table id="table_lider" name="table_lider" class="table table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody id="tbodyid2">
              <tr>
              </tr>
              <tr>
              </tr>
          </tbody>  
        </table>
      </div>
      <div class="modal-footer">
      </div>
  </div>  
</fieldset>


<script>

  function buscaPessoa(){

      var pesquisa;

        pesquisa = $('#NOME_lider_buscar').val();

      $.ajax({
        url: '<%= listarPessoa_path %>',
        data : 
        {
            NOME_pessoa : pesquisa
        },
        success: function(data){
          $("#tbodyid").empty();
          $("#tbodyid2").empty();
          for (var i in data) {
            var item = data[i];

              $('#table_lider').append('<tr><td><a href="javascript:setaLider(\'' + item.NOME_pessoa+'\','+item.id+');">'+item.NOME_pessoa+'</a></td><td><a href="javascript:setaLider(\'' + item.NOME_pessoa+'\','+item.id+');">'+item.DESC_email+'</a></td></tr>');

          };
 
        }
      })
    }

  function setaLider(nome,id){

      $('#sivic_celula_sivic_pessoa_id').empty();
      $('#sivic_celula_sivic_pessoa_id').html('<option>Carregando...</option>');

      var options = "<option value='"+id+"'>"+nome+"</option>";
      $('#sivic_celula_sivic_pessoa_id').html(options);

      $('#myModal').modal('hide');
  }  

  function changeState(state){
      $.ajax({
        url: '<%= listarCidade_path %>',
        data : {id : state.value},
        success: function(data){
          $('#sivic_celula_sivic_endereco_attributes_sivic_cidade_id').empty();
          $('#sivic_celula_sivic_endereco_attributes_sivic_cidade_id').html('<option>Carregando...</option>');
          $('#sivic_celula_sivic_endereco_attributes_sivic_cidade_id').attr('disabled', 'disabled');
          var options = "";
          for (var i in data) {
            var item = data[i];
            options += "<option value='"+item.id+"'>"+item.name+"</option>"
          };
 
          $('#sivic_celula_sivic_endereco_attributes_sivic_cidade_id').html(options);
          $('#sivic_celula_sivic_endereco_attributes_sivic_cidade_id').removeAttr('disabled');          
        }
      })
    }
</script>