<%= form_for(@sivic_discipulo) do |f| %>
  <% if @sivic_discipulo.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@sivic_discipulo.errors.count, "error") %> prohibited this sivic_discipulo from being saved:</h2>

      <ul>
      <% @sivic_discipulo.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <%=  f.fields_for :sivic_pessoa do |pessoa| %>
    <div class="field">
      <%= pessoa.label :Nome %><br>
      <%= pessoa.text_field :NOME_pessoa, :onclick => "$('#myModal2').modal('show')" %>
    </div>
    <div class="field">
      <%= pessoa.label :Lider %><br>
      <%= pessoa.select :father_id, options_from_collection_for_select(SivicPessoa.all, 'id', 'NOME_pessoa',@sivic_lider),:include_blank => true%>
    </div>     
    <div class="field">
      <%= pessoa.label :Email %><br>
      <%= pessoa.text_field :DESC_email %>
    </div>
    <div class="field">
      <%= pessoa.label :Observação %><br>
      <%= pessoa.text_field :DESC_observacao %>
    </div>
    <div class="field">
      <%= pessoa.hidden_field :sivic_igreja_id, :value => current_user.sivic_pessoa.sivic_igreja.id %>
    </div>
    <div class="field">
      <%= pessoa.hidden_field :User_id, :value => current_user.id%>
    </div>
  <%end%>


  <div class="field">
    <%= f.hidden_field :sivic_pessoa_id%>
  </div>
  <div class="field">
    <%= f.label :Endereço %><br>
    <%= f.text_field :sivic_endereco_id,  :value => 1 %>
  </div>
  <div class="field">
    <%= f.label :Profissão %><br>
    <%#= f.text_field :sivic_profissao_id %>
    <%= f.select :sivic_profissao_id, options_from_collection_for_select(SivicProfissao.all, 'id', 'profissao')%>
  </div>
  <div class="field">
    <%= f.label :Escolaridade %><br>
    <%#= f.text_field :sivic_escolaridade_id %>
    <%= f.select :sivic_escolaridade_id, options_from_collection_for_select(SivicEscolaridade.all, 'id', 'NOME_escolaridade')%>
  </div>
  <div class="field">
    <%= f.label :Rede %><br>
    <%#= f.text_field :sivic_rede_id %>
    <%= f.select :sivic_rede_id, options_from_collection_for_select(SivicRede.all, 'id', 'nome_rede')%>
  </div>
  <div class="field">
    <%= f.label :Célula %><br>
    <%#= f.text_field :sivic_celula_id %>
    <%= f.select :sivic_celula_id, options_from_collection_for_select(SivicCelula.all, 'id', 'NUMR_Dia')%>
  </div>
  <div class="field">
    <%= f.label :Profissão_do_Conjuge %><br>
    <%#= f.number_field :NUMG_ProfissaoConjuge %>
    <%= f.select :NUMG_ProfissaoConjuge, options_from_collection_for_select(SivicProfissao.all, 'id', 'profissao')%>
  </div>
  <div class="field">
    <%= f.hidden_field :NUMG_UsuarioInclusao, :value => current_user.id %>
  </div>
  <div class="field">
    <%= f.hidden_field :NUMG_UsuarioBloqueio, :value => current_user.id%>
  </div>
  <div class="field">
    <%= f.label :Orientação_Sexual %><br>
    <%#= f.text_field :DESC_Sexo %>
    <%= f.collection_select :DESC_Sexo, SivicDiscipulo::SEXO, :to_s, :humanize %>
  </div>
  <div class="field">
    <%= f.label :Data_de_Nascimento %><br>
    <%= f.date_select :DATA_Nascimento %>
  </div>
  <div class="field">
    <%= f.label :Apelido %><br>
    <%= f.text_field :DESC_Apelido %>
  </div>
  <div class="field">
    <%= f.label :Estado_Civil %><br>
    <%#= f.text_field :DESC_EstadoCivil %>
    <%= f.collection_select :DESC_EstadoCivil, SivicDiscipulo::ESTADOCIVIL, :to_s, :humanize %>
  </div>
  <div class="field">
    <%= f.label :Nome_do_Conjuge %><br>
    <%= f.text_field :NOME_Conjuge %>
  </div>
  <div class="field">
    <%= f.label :Data_da_Decisao %><br>
    <%= f.date_select :DATA_Decisao %>
  </div>
  <div class="field">
    <%= f.label :Quantidade_de_Filhos %><br>
    <%= f.number_field :NUMR_QtdFilhos %>
  </div>
  <table>
    <tr>
      <td>
        <div class="field">
          <%= f.label :Membro %><br>
          <%= f.check_box :FLAG_Membro %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :Recebeu_Cristo %><br>
          <%= f.check_box :FLAG_RecebeuCristo %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :Reconciliacao %><br>
          <%= f.check_box :FLAG_Reconciliacao %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :Ocasiao_Celula %><br>
          <%= f.check_box :FLAG_OcasiaoCelula %>
        </div>
      </td>
    </tr>
    <tr>      
      <td>
        <div class="field">
          <%= f.label :Ocasiao_Celebração_Evento %><br>
          <%= f.check_box :FLAG_OcasiaoCelebracaoEvento %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :Ocasiao_Evangelismo_Pessoal %><br>
          <%= f.check_box :FLAG_OcasiaoEvangelismoPessoal %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :Ocasiao_Culto_Livre %><br>
          <%= f.check_box :FLAG_OcasiaoCultoLivre %>
        </div>
      </td>
      <td>
        <div class="field">
          <%= f.label :Trabalhando %><br>
          <%= f.check_box :FLAG_Trabalhando %>
        </div>
      </td>
    </tr>
  </table>
  <div class="field">
    <%= f.label :Momento_Estudo_Biblico %><br>
    <%= f.text_field :DESC_MomentoEstudoBiblico %>
  </div>
  <div class="field">
    <%= f.label :RG %><br>
    <%= f.text_field :NUMR_RG %>
  </div>
  <div class="field">
    <%= f.label :Data_Emissao_RG %><br>
    <%= f.date_select :DATA_EmissaoRG %>
  </div>
  <div class="field">
    <%= f.label :CPF %><br>
    <%= f.text_field :NUMR_CPF %>
  </div>
  <div class="field">
    <%= f.label :Nome_do_Pai %><br>
    <%= f.text_field :NOME_Pai %>
  </div>
  <div class="field">
    <%= f.label :Nome_da_Mae %><br>
    <%= f.text_field :NOME_Mae %>
  </div>
  <div class="field">
    <%= f.label :Data_de_Nascimneto_do_Conjuge %><br>
    <%= f.date_select :DATA_NascConjuge %>
  </div>
  <div class="field">
    <%= f.label :Data_de_Casamento %><br>
    <%= f.date_select :DATA_Casamento %>
  </div>
  <div class="field">
    <%= f.label :Titulo_Eleitoral %><br>
    <%= f.text_field :NUMR_TituloEleitoral %>
  </div>
  <div class="field">
    <%= f.label :DATA_de_Batismo %><br>
    <%= f.date_select :DATA_Batismo %>
  </div>
  <div class="field">
    <%= f.label :Igreja_de_Batismo %><br>
    <%= f.text_field :DESC_IgrejaBatismo %>
  </div>
  <div class="field">
    <%= f.label :Doador_de_Sangue %><br>
    <%= f.check_box :FLAG_DoadorSangue %>
  </div>
  <div class="field">
    <%= f.label :Doador_de_Orgao %><br>
    <%= f.check_box :FLAG_DoadorOrgao %>
  </div>
  <div class="actions">
    <%= f.submit %>
  </div>
<% end %>


</fieldset>

  <div id="myModal2" class="modal fade" style="display: none;">  
      <div class="modal-header">  
        <a class="close" data-dismiss="modal">×</a>  
        <h3>Buscar Pessoas</h3>  
      </div>  
      <div class="modal-body">
        <div class="input-group input-group-lg">
          <label >Nome</label><br>
          <input id="NOME_pessoa_buscar" name="NOME_pessoa_buscar" onkeypress="buscaPessoa()" type="text" class="form-control" placeholder="Nome" style="width: 300px;">
          <a data-toggle="modal" href="javascript:usaNome();" class="btn btn-success" style="margin-bottom: 10px;">Usar</a>
        </div>
        <table id="table_user" name="table_user" class="table table-hover">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody id="tbodyid">
              <tr>
              </tr>
              <tr>
              </tr>
          </tbody>  
        </table>
      </div>
      <div class="modal-footer">
      </div>
  </div>  

</fieldset>

<script>
  function buscaPessoa(){

      $.ajax({
        url: '<%= listarPessoa_path %>',
        data : 
        {
            NOME_pessoa : $('#NOME_pessoa_buscar').val()
        },
        success: function(data){
          $("#tbodyid").empty();
          for (var i in data) {
            var item = data[i];
            $('#table_user').append('<tr><td><a href="javascript:setaNome(\'' + item.NOME_pessoa+'\','+item.id+',\'' + item.DESC_email+'\','+item.father_id+',\''+item.NOME_Lider+'\');">'+item.NOME_pessoa+'</a></td><td><a href="javascript:setaNome(\'' + item.NOME_pessoa+'\','+item.id+',\'' + item.DESC_email+'\');">'+item.DESC_email+'</a></td></tr>')
          };
 
        }
      })
    }

  function setaNome(nome,id,email,idlider,nomelider){

          $('#sivic_discipulo_sivic_pessoa_id').val(id)
          $('#sivic_discipulo_sivic_pessoa_attributes_NOME_pessoa').val(nome)
          $('#sivic_discipulo_sivic_pessoa_attributes_NOME_pessoa').attr('disabled', 'disabled');
          $('#sivic_discipulo_sivic_pessoa_attributes_DESC_email').val(email)
          $('#sivic_discipulo_sivic_pessoa_attributes_DESC_email').attr('disabled', 'disabled');
          $('#sivic_discipulo_sivic_pessoa_attributes_DESC_observacao').attr('disabled', 'disabled');

          $('#sivic_discipulo_sivic_pessoa_attributes_father_id').empty();
          $('#sivic_discipulo_sivic_pessoa_attributes_father_id').html('<option>Carregando...</option>');
          $('#sivic_discipulo_sivic_pessoa_attributes_father_id').attr('disabled', 'disabled');
          var options = "<option value='"+idlider+"'>"+nomelider+"</option>";
          $('#sivic_discipulo_sivic_pessoa_attributes_father_id').html(options);
                

          $('#myModal2').modal('hide');
  }

  function usaNome(nome){

          $('#sivic_discipulo_sivic_pessoa_attributes_NOME_pessoa').val($('#NOME_pessoa_buscar').val());
          $('#myModal2').modal('hide');
  }   

</script>