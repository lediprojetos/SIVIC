<% content_for :titlePage do %>
  Relatório de Células
<% end %>

<%=render '/layouts/panel' %>

<table style="width:50%;">
  <tr>
    <td>
      <label >Situação</label>
      <select id='sivic_estado_sivic_situacoesrelatorio_id'>
        <option value='0'></option>
        <option value='1'>ENVIADO</option>
        <option value='2'>PENDENTE</option>
        <option value='3'>RECEBIDO</option>
    </td>
    <td>
          <label >Líder</label>
          <input id="NOME_pessoa_buscar" name="NOME_pessoa_buscar" type="text" placeholder="Nome do Líder" style="width: 90%;">
    </td>
    <td>
      <div style='margin-top:15px;'>
        <a data-toggle="modal" href="javascript:chamaPesquisa();" class="btn btn-info" style="">Buscar</a><br/>
      </div>
    </td>
  </tr>
</table>

  <hr>

<div class="containermininmo">

<table class="table table-hover">
  <thead>
    <tr>
      <th>Líder</th>
      <th>Dia</th>
      <th>Data da Reunião</th>
      <th>Início</th>
      <th>Término</th>
      <th>Valor de Oferta</th>
      <th>Situação</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>

  <tbody>
    <% @sivic_relatorioscelulas.each do |sivic_relatorioscelula| %>
      <tr>
        <td><%= sivic_relatorioscelula.sivic_celula.sivic_pessoa.NOME_pessoa %></td>
        <td><%= sivic_relatorioscelula.sivic_celula.NUMR_Dia %></td>
        <td><%= sivic_relatorioscelula.DATA_Reuniao.blank? ? '' : sivic_relatorioscelula.DATA_Reuniao.strftime("%d/%m/%Y")  %></td>
        <td><%= sivic_relatorioscelula.DATA_Horainicio.blank? ? '' : sivic_relatorioscelula.DATA_Horainicio.strftime("%H:%M")  %></td>
        <td><%= sivic_relatorioscelula.DATA_HoraTermino.blank? ? '' : sivic_relatorioscelula.DATA_HoraTermino.strftime("%H:%M")  %></td>
        <td><%= sivic_relatorioscelula.VALR_Oferta %></td>
        <%if sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao == 'ENVIADO'%>
          <td><b style='color:orange;'><%= sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao %></b></td>
        <%elsif sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao == 'PENDENTE'%>
          <td><b style='color:red;'><%= sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao %></b></td>
        <%elsif sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao == 'RECEBIDO'%>
          <td><b style='color:green;'><%= sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao %></b></td>
        <%end%>
        <td><%= link_to image_tag('show.png', :title => 'Exibir', class: 'exibirico') , sivic_relatorioscelula %></td>
        <td>
        <%if sivic_relatorioscelula.sivic_situacoesrelatorio.DESC_Situacao == 'PENDENTE'%>
          <%= link_to image_tag('edit.png', :title => 'Editar',  class: 'exibirico') , edit_sivic_relatorioscelula_path(sivic_relatorioscelula) %>
        <%end%>
        </td>
            <td><%= link_to image_tag('trash.png', :title => 'Excluir',  class: 'exibirico'), sivic_relatorioscelula , :method => :delete,  :confirm => 'Deseja excluir o registro?'%></td>            
      </tr>
    <% end %>
  </tbody>
</table>

</div>

<div class="apple_pagination">
<%= will_paginate @sivic_relatorioscelulas %>
</div>

</div></div>

<table style="margin-top:10px;">
  <tr>
    <td align="center" style="width:50px;">
      <%= link_to image_tag('new.png', :title => 'Novo', class: 'exibirico') , new_sivic_relatorioscelula_path %>
    </td>
  </tr>
  <tr>
    <td align="center" style="width:20px;">
      <label class="altBotoes">Novo</label>
    </td>
  </tr> 
</table>

<script>

  function chamaPesquisa(){

    nome = $('#NOME_pessoa_buscar').val()
    situacao = $('#sivic_estado_sivic_situacoesrelatorio_id').val().trim();

    if (situacao == "0" && situacao == ""){
      window.location = '/sivic_relatorioscelulas/';
      return false;
    }

    if (situacao == ""){
      situacao = 0;
    }

    if (nome == ""){
      nome = 0;
    }    

    window.location = '/filtrarelatorios/' + situacao +'/' + nome;

  }

</script>